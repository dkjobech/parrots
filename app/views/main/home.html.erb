<h1>Welcome to Room <%= @room %></h1>

<button id="whisper-btn" class="btn btn-primary">Whisper</button>

<div id="joke-response" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; display: none;">
</div>

<div id="messages" style="margin-top: 20px;">
</div>

<script type="text/javascript">
    window.currentRoom = "<%= @room %>";


    // Whisper button functionality
    document.getElementById('whisper-btn').addEventListener('click', function() {
        // Clear all responses
        document.getElementById('joke-response').style.display = 'none';
        document.getElementById('messages').innerHTML = '';

        // Show loading state
        this.disabled = true;
        this.textContent = 'Getting joke...';

        // Make AJAX call to get joke
        fetch('queue', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
            },
            body: JSON.stringify({ room: window.currentRoom })
        })
            .then(response => response.json())
            .then(data => {
                const responseDiv = document.getElementById('joke-response');
                responseDiv.textContent = data.joke;
                responseDiv.style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                const responseDiv = document.getElementById('joke-response');
                responseDiv.textContent = 'Error getting joke: ' + error.message;
                responseDiv.style.display = 'block';
            })
            .finally(() => {
                // Reset button
                this.disabled = false;
                this.textContent = 'Whisper';
            });
    });
</script>